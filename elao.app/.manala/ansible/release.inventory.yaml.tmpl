all:
    children:
    {{- range $release := .Vars.releases }}

        {{ include "release_group" $release }}:
            hosts:
                localhost{{ include "release_host" $release }}:
                    ansible_connection: local
            vars:
                release_dir: /srv/release/{{ if hasKey $release "app" }}{{ $release.app }}/{{ end }}{{ $release.mode }}
                release_source_repo: /srv/app
                {{- if hasKey $release "app" }}
                release_working_dir: {{ $release.app }}
                {{- end }}
                release_repo: {{ $release.repo }}
                {{- if hasKey $release "mode" }}
                release_version: {{ if hasKey $release "app" }}{{ $release.app }}/{{ end }}{{ $release.mode }}
                {{- end }}
                {{- if hasKey $release "release_tasks" }}
                release_tasks:
                    {{- include "release_tasks" $release.release_tasks | nindent 18 }}
                {{- end }}
                {{- if hasKey $release "release_removed" }}
                release_exclude:
                    {{- $release.release_removed | toYaml | nindent 18 }}
                {{- end }}
                {{- if hasKey $release "release_add" }}
                release_include:
                    {{- $release.release_add | toYaml | nindent 18 }}
                {{- end }}
    {{- end }}
