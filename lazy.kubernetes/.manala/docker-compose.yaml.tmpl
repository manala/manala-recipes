{{- $now := dateInZone "20060102150405" (now) "UTC" -}}

version: "3.7"

services:

  ##########
  # System #
  ##########

  system:
    hostname: {{ .Vars.project.name }}
    build:
      context: .
      target: system
    image: {{ .Vars.project.name }}:{{ $now }}
    volumes:
      - ..:${DIR}
      {{- range $mount := .Vars.system.mount }}
      - ../{{ $mount }}:${DIR}/{{ $mount }}
      {{- end }}
    environment:
      DIR: ${DIR}
      CACHE_DIR: ${CACHE_DIR}
      {{- range $key, $value := .Vars.system.env }}
      {{ $key }}: {{ $value }}
      {{- end }}
    working_dir: ${DIR}
    entrypoint: .manala/docker/entrypoint
    # Use default docker bridge network
    network_mode: bridge
